# The different services that make up our "network" of containers
services:
  neo4j:
    # The image to use
    image: neo4j:5
    # mounting a named volume to the container to track db data
    volumes:
      - neo4j_data:/data/
    environment:
      NEO4J_AUTH: "neo4j/password" # MAKE SURE TO USE SOMETHING SAFE HERE. Username cannot be changed. See: https://neo4j.com/docs/operations-manual/current/docker/introduction/#docker-auth
      NEO4J_dbms_security_auth__minimum__password__length: 8
      NEO4J_ACCEPT_LICENSE_AGREEMENT: "yes"
    healthcheck:
      test: [ "CMD", "neo4j", "status" ]
      interval: 10s
      timeout: 1s
      retries: 10
  app:
    image: ghcr.io/modul-graph/modul_graph:latest
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      NEO4J_URI: "bolt://neo4j:password@neo4j:7687" # Make sure username/password matched neo4j config
    depends_on:
      neo4j:
        condition: service_healthy

## volumes to be generated, these are saved somewhere for repeated use by docker
volumes:
  neo4j_data:
